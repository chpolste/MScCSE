Reachability/Avoidance through a corridor.

\startformula
    \VecX_{t+1} = \TwoByTwo{1}{0}{0}{1} \VecState_{t} + \TwoByTwo{1}{0}{0}{1} \VecControl_{t} + \VecRandom_{t} \EndComma
\stopformula

where $\VecState_{t} \in \StateSpace = \ClosedInterval{0}{4} \times \ClosedInterval{0}{3}$, $\VecControl_{t} \in \ControlSpace = \ClosedInterval{-0.5}{0.5}^2$ and $\VecRandom_{t} \in \RandomSpace = \ClosedInterval{-0.1}{0.1}^2$.

\startsubsection[title={Reachability Analysis},reference=sec:cases-corridor-reachability]

    \placetable[top][tab:cases-corridor-reachability]{
        TODO
        See \in{section}[sec:cases-corridor-reachability] for discussion.
    }{
        \RefinementTable{
            \RefinementTableRow[iteration={},polys=65,onestates=140,oneactions=6856,twostates=6778,twoactions=85804,
                                total={1:35},refinement={0:02},gamegraph={1:29},analysis={0:04},
                                yes=69.7,no=30.3,maybe=0.0,figure=cases-corridor-reachability]
        }
    }

    First look at objective avoidance and reachability objective

    \startformula
        ( \neg \pi ) \Until \varphi
    \stopformula

    co-safe interpretation.
    Narrow passage between two rooms, challenge is the relatively precise control required to enter the corridor.

    Solve with multi-step robust refinement.
    Show problem with long thin states and skipping of small states.
    Show variations in progress due to randomization.

    Layered refinement.
    Demonstrate how variability of solution due to randomized $\RefinePos$ is stabilized.
    Note that refinement around corridor entrance is finer that in rest of the room.

    2-dimensional control space.
    Compare game complexity to double integrator with 1D control space.

\stopsubsection


\startsubsection[title={Reachability Controller}]

    \placefigure[top][fig:cases-corridor-reachability-trace]{
        TODO
    }{
        \startcombination[nx=2,ny=1,distance=10mm]
            {\externalfigure[cases-corridor-reachability-trace-robin][width=0.49\textwidth]}{}
            {\externalfigure[cases-corridor-reachability-trace-layers][width=0.49\textwidth]}{}
        \stopcombination
    }

    Problematic performance of round-robin controller which does not violate avoidance objective but does not want to enter the corridor.
    Apply layered approach to reachability.
    Show off reordered round-robin controller for reachability that does better job of guiding the trace through the corridor.

\stopsubsection


\startreusableMPgraphic{cases-corridor-recurrence-automaton}
    beginfig(0);
        with spacing((17,15)) matrix.a(9,9);
        node_double.a[1][1](btex $q_0$ etex);
        node_dash.a[1][8](btex $q_1$ etex);
        node_dash.a[8][1](btex $q_2$ etex);
        % Outgoing transitions of q0
        incoming(0, "") (a[1][1]) 180;
        loop.top(.4, btex \small \;$ \neg \theta \wedge \phi \wedge \mu$ etex) (a[1][1]) 90;
        arrow.top(.5, btex \small $ \neg \theta \wedge \phi $ etex) (a[1][1],a[1][8]) a[1][1].c..a[0][4].c..a[0][5].c..a[1][8].c;
        arrow.rt(.5, btex \small $ \neg (\theta \vee \phi)$ etex) (a[1][1],a[8][1]) a[1][1].c..a[4][2].c..a[5][2].c..a[8][1].c;
        % Outgoing transitions of q1
        loop.top(.4, btex \small \;$ \neg (\theta \vee \phi) $ etex) (a[1][8]) 90;
        arrow.bot(.5, btex \small $ \neg \theta \wedge \phi \wedge \mu $ etex) (a[1][8],a[1][1]) a[1][8].c..a[2][5].c..a[2][4].c..a[1][1].c;
        arrow.rt(.4, btex \small \qquad$ \neg (\theta \vee \mu) \wedge \phi $ etex) (a[1][8],a[8][1]) a[1][8].c..a[2][8].c..a[8][2].c..a[8][1].c;
        % Outgoing transitions of q2
        loop.bot(.5, btex \small \;$ \neg (\theta \vee \mu) $ etex) (a[8][1]) 270;
        arrow.lft(.5, btex \small $ \neg \theta \wedge \mu $ etex) (a[8][1],a[1][1]) a[8][1].c..a[5][0].c..a[4][0].c..a[1][1].c;
    endfig;
\stopreusableMPgraphic

\startreusableMPgraphic{cases-corridor-recurrence-automaton-pruned}
    beginfig(0);
        with spacing((17,15)) matrix.a(9,9);
        node_double.a[1][1](btex $q_0$ etex);
        node_dash.a[1][8](btex $q_1$ etex);
        node_dash.a[8][1](btex $q_2$ etex);
        % Outgoing transitions of q0
        incoming(0, "") (a[1][1]) 180;
        arrow.top(.5, btex \small $ \neg \theta \wedge \phi $ etex) (a[1][1],a[1][8]) a[1][1].c..a[0][4].c..a[0][5].c..a[1][8].c;
        arrow.rt(.5, btex \small $ \neg (\theta \vee \phi)$ etex) (a[1][1],a[8][1]) a[1][1].c..a[4][2].c..a[5][2].c..a[8][1].c;
        % Outgoing transitions of q1
        loop.top(.4, btex \small \;$ \neg (\theta \vee \phi) $ etex) (a[1][8]) 90;
        arrow.rt(.4, btex \small \qquad$ \neg (\theta \vee \mu) \wedge \phi $ etex) (a[1][8],a[8][1]) a[1][8].c..a[2][8].c..a[8][2].c..a[8][1].c;
        % Outgoing transitions of q2
        loop.bot(.5, btex \small \;$ \neg (\theta \vee \mu) $ etex) (a[8][1]) 270;
        arrow.lft(.5, btex \small $ \neg \theta \wedge \mu $ etex) (a[8][1],a[1][1]) a[8][1].c..a[5][0].c..a[4][0].c..a[1][1].c;
    endfig;
\stopreusableMPgraphic

\startsubsection[title={2-Recurrence and Safety},reference=sec:cases-corridor-recurrence]

    \placefigure[top][fig:cases-corridor-recurrence-automaton]{
        TODO
    }{
        \startcombination[nx=2,ny=1,distance=10mm]
            {\reuseMPgraphic{cases-corridor-recurrence-automaton}}{}
            {\reuseMPgraphic{cases-corridor-recurrence-automaton-pruned}}{}
        \stopcombination
    }

    Finally consider a sighly more complex objective that requires traces to visit both rooms over and over again while avoiding the walls of the corridor

    \startformula
        \Globally (\neg a \wedge \Finally b \wedge \Finally c )
    \stopformula

    No co-safe interpretation.

    Explain repeated (q0 q1 q2) trace as decomposition targets.
    Mention that refinement for one direction only does not lead to satisfaction for entire objective.

    \placetable[top][tab:cases-corridor-recurrence]{
        TODO
        See \in{section}[sec:cases-corridor-recurrence] for discussion.
    }{
        \RefinementTable{
            \RefinementTableRow[iteration={},polys=122,onestates=339,oneactions=46768,twostates=25139,twoactions=610511,
                                total={3:11},refinement={0:02},gamegraph={2:09},analysis={1:00},
                                yes=69.7,no=30.3,maybe=0.0,figure=cases-corridor-recurrence]
        }
    }

    Apply layered refinement for both transitions.
    Note that overrefinement in corridor occurs due to fixed layer structure.
    Mention blow up of state space and that no progress guarantee can help here as nothing is in yes-region at the beginning.

    \placefigure[top][fig:cases-corridor-recurrence-trace]{
        TODO
    }{
        \externalfigure[cases-corridor-recurrence-trace][width=0.8\textwidth]
    }
    
    Use layered approach again for controller synthesis.

\stopsubsection

